<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Office Communication Trainer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb;
            padding-bottom: 72px; /* Space for the fixed guide bar */
        }
        
        .whatsapp-bg {
            /* Updated to a deeper, more professional green */
            background: linear-gradient(135deg, #059669 0%, #065F46 100%); 
        }
        
        .chat-container {
            /* More visually interesting, higher-contrast pattern */
            background: #E5DDD5;
            background-image: url("data:image/svg+xml,%3Csvg width='120' height='120' viewBox='0 0 120 120' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23d9dad3' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.05);
            /* Fixed Height for consistent UX and better scroll management */
            height: 500px; 
            overflow-y: auto;
        }
        
        .message-bubble {
            max-width: 80%;
            word-wrap: break-word;
            animation: messageSlide 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .received-message {
            background: #FFFFFF;
            border-radius: 12px 12px 12px 4px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
        }
        
        .sent-message {
            background: #DCECF7;
            border-radius: 12px 12px 4px 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
        }
        
        .option-button {
            transition: all 0.3s ease;
            border: 2px solid transparent;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            outline: none;
            cursor: pointer;
        }

        .option-button.cursor-not-allowed {
            cursor: not-allowed;
        }
        
        .option-button:focus:not([disabled]) {
            box-shadow: 0 0 0 4px #bbf7d0;
        }
        
        .option-button:hover:not([disabled]) {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
        }
        
        /* Highlighting for selected/disabled options */
        .option-correct {
            border-color: #059669;
            background: #D1FAE5 !important; /* Lighter shade of green for correct selected */
            color: #065F46;
        }
        
        .option-incorrect {
            border-color: #DC2626;
            background: #FEE2E2 !important; /* Lighter shade of red for incorrect selected */
            color: #991B1B;
        }
        
        .scenario-card {
            transition: all 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
            border: none;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        .scenario-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2), 0 10px 10px -5px rgba(0, 0, 0, 0.1);
        }

        .guide-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 50;
            background-color: #fff; 
            border-top: 5px solid #059669;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Styling for the hidden element in the modal (when answer is correct) */
        .hidden-when-correct {
            display: none !important;
        }

    </style>
</head>
<body class="min-h-full">
    <div class="whatsapp-bg text-white p-4 shadow-2xl">
        <div class="max-w-4xl mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <div class="w-14 h-14 bg-white rounded-full flex items-center justify-center text-3xl shadow-lg">üí¨</div>
                <div>
                    <h1 class="text-3xl font-extrabold">Office Comm. Trainer</h1>
                    <p class="text-green-200 text-sm">Elevate your professional messaging</p>
                </div>
            </div>
            <div class="text-right">
                <div class="text-sm opacity-90">Training Progress</div>
                <div class="w-32 bg-green-800 rounded-full h-3 mt-1 overflow-hidden">
                    <div class="progress-bar bg-cyan-400 h-full rounded-full" style="width: 0%" id="progressBar"></div>
                </div>
                <div class="text-xs mt-1 text-green-200" id="progressText">0/5 Scenarios</div>
            </div>
        </div>
    </div>

    <div class="max-w-4xl mx-auto p-6 pb-24">
        
        <div id="welcomeScreen" class="text-center py-16">
            <div class="text-9xl mb-6 animate-pulse-slow">üöÄ</div>
            <h2 class="text-5xl font-extrabold text-gray-800 mb-4">Master Professional WhatsApp Communication</h2>
            <p class="text-xl text-gray-600 mb-10 max-w-2xl mx-auto">
                Step into interactive role-play scenarios to practice and perfect your communication skills for the modern office environment.
            </p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                <div class="bg-white p-6 rounded-2xl shadow-xl border-t-4 border-emerald-500 transform hover:scale-105 transition-transform">
                    <div class="text-5xl mb-3">üéØ</div>
                    <h3 class="font-bold text-xl mb-2 text-gray-800">High-Fidelity Scenarios</h3>
                    <p class="text-gray-500 text-sm">Practice with actual office situations you'll encounter</p>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-xl border-t-4 border-yellow-500 transform hover:scale-105 transition-transform">
                    <div class="text-5xl mb-3">üí°</div>
                    <h3 class="font-bold text-xl mb-2 text-gray-800">Detailed Feedback</h3>
                    <p class="text-gray-500 text-sm">Instantly learn why certain responses work better than others</p>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-xl border-t-4 border-indigo-500 transform hover:scale-105 transition-transform">
                    <div class="text-5xl mb-3">üèÜ</div>
                    <h3 class="font-bold text-xl mb-2 text-gray-800">Track & Gamify</h3>
                    <p class="text-gray-500 text-sm">See your improvement and earn exclusive communication badges</p>
                </div>
            </div>
            
            <button onclick="startTraining()" class="bg-lime-600 hover:bg-lime-700 text-white px-10 py-5 rounded-full font-bold text-xl transform hover:scale-105 transition-all shadow-2xl hover:shadow-3xl focus:outline-none focus:ring-4 focus:ring-lime-300">
                üöÄ Start Your Training Journey
            </button>
            
            <div class="mt-8">
                <a href="https://drive.google.com/file/d/1Iatt4vVgVPGZuDb-YI0t6OR7KNA2O4O5/view?usp=sharing" 
                   target="_blank" 
                   class="inline-flex items-center space-x-3 bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-3 rounded-full font-bold text-lg transform hover:scale-105 transition-all shadow-xl hover:shadow-2xl focus:outline-none focus:ring-4 focus:ring-indigo-300">
                    <span class="text-2xl leading-none">üìÑ</span>
                    <span>View Case Study (PDF)</span>
                </a>
            </div>
            </div>

        <div id="scenarioSelection" class="hidden">
            <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center border-b-2 pb-4">Choose Your Training Scenario</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8" id="scenarioGrid">
                </div>
        </div>

        <div id="chatInterface" class="hidden rounded-xl shadow-2xl overflow-hidden mb-10">
            <div class="bg-emerald-600 text-white p-4 flex items-center space-x-4 shadow-md">
                <button onclick="backToScenarios()" class="text-white hover:bg-emerald-700 p-2 rounded-full transition-all">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>
                </button>
                <div class="w-12 h-12 bg-gray-300 rounded-full flex items-center justify-center text-xl font-bold text-gray-800" id="groupAvatar">üë•</div>
                <div>
                    <div class="font-bold text-xl" id="groupName">Office Group</div>
                    <div class="text-sm text-green-100" id="groupInfo">5 participants</div>
                </div>
            </div>

            <div class="chat-container" id="chatMessages">
                </div>

            <div class="bg-white p-6 border-t-4 border-gray-100" id="responseOptions">
                <div class="text-lg font-semibold text-gray-800 mb-4" id="situationPrompt">How would you respond?</div>
                <div class="space-y-3" id="optionButtons">
                    </div>
            </div>
        </div>

        <div id="resultsScreen" class="hidden text-center py-16 bg-white rounded-xl shadow-2xl">
            <div class="text-9xl mb-6" id="resultEmoji">üéâ</div>
            <h2 class="text-5xl font-extrabold text-gray-800 mb-4" id="resultTitle">Great Job!</h2>
            <p class="text-xl text-gray-600 mb-10 max-w-2xl mx-auto" id="resultMessage">You've completed the training scenario.</p>
            
            <div class="bg-gray-50 rounded-xl p-8 shadow-inner max-w-2xl mx-auto mb-10 border-t-4 border-lime-400">
                <h3 class="text-3xl font-bold mb-8 text-gray-800">Your Performance</h3>
                <div class="grid grid-cols-3 gap-8">
                    <div class="text-center">
                        <div class="text-5xl font-extrabold text-green-600" id="correctAnswers">0</div>
                        <div class="text-sm text-gray-500 mt-2">Correct Responses</div>
                    </div>
                    <div class="text-center">
                        <div class="text-5xl font-extrabold text-blue-600" id="totalQuestions">0</div>
                        <div class="text-sm text-gray-500 mt-2">Total Questions</div>
                    </div>
                    <div class="text-center">
                        <div class="text-5xl font-extrabold text-purple-600" id="scorePercentage">0%</div>
                        <div class="text-sm text-gray-500 mt-2">Success Rate</div>
                    </div>
                </div>
            </div>

            <div class="flex justify-center space-x-6">
                <button onclick="backToScenarios()" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-4 rounded-full font-bold transition-all shadow-lg hover:shadow-xl">
                    Try Another Scenario
                </button>
                <button onclick="restartScenario()" class="bg-lime-600 hover:bg-lime-700 text-white px-8 py-4 rounded-full font-bold transition-all shadow-lg hover:shadow-xl">
                    Retry This Scenario
                </button>
            </div>
        </div>
    </div>
    
    <div id="achievementNotification" class="fixed top-6 right-6 bg-white text-gray-800 p-5 rounded-xl shadow-2xl transform translate-x-full transition-transform duration-500 ease-out z-50 border-l-4 border-yellow-500">
        <div class="flex items-center space-x-4">
            <div class="text-4xl" id="achievementIcon">üèÜ</div>
            <div>
                <div class="font-extrabold text-xl" id="achievementTitle">Achievement Unlocked!</div>
                <div class="text-sm text-gray-600" id="achievementDesc">Great communication skills!</div>
            </div>
        </div>
    </div>
    
    <div id="guideBar" class="guide-bar p-4">
        <div class="max-w-4xl mx-auto flex items-center space-x-3 text-lg font-semibold text-gray-800">
            <div class="text-2xl text-emerald-600">üëâ</div>
            <div id="guideMessage" class="text-gray-700">Click the 'üöÄ Start Your Training Journey' button above to begin!</div>
        </div>
    </div>

    <div id="feedbackModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden z-[100] flex items-center justify-center transition-opacity duration-300">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-xl w-full mx-4 transform transition-transform duration-300">
            <div id="modalIcon" class="text-7xl mb-4 text-center"></div>
            <h3 id="modalTitle" class="text-3xl font-extrabold text-gray-800 mb-6 text-center"></h3>
            
            <div class="mb-8 space-y-4">
                <div id="selectedOptionDisplay" class="p-3 border-l-4 rounded-md shadow-inner">
                    <div class="font-bold text-sm mb-1 text-gray-600">Your Response:</div>
                    <div id="userResponseText" class="text-gray-900 font-medium"></div>
                </div>
                
                <div id="correctResponseDisplay" class="p-4 bg-green-50 border-l-4 border-green-500 rounded-md shadow-md">
                    <div class="font-bold text-base text-green-800 mb-2">The Best Approach:</div>
                    <div id="correctResponseText" class="text-green-900 font-medium"></div>
                </div>

                <div id="feedbackReason" class="p-4 bg-blue-50 border-l-4 border-blue-500 rounded-md shadow-md">
                    <div class="font-bold text-base text-blue-800 mb-2">Detailed Reason:</div>
                    <div id="reasonText" class="text-blue-900 text-sm leading-relaxed"></div>
                </div>
            </div>
            
            <div class="flex justify-end">
                <button onclick="nextStepFromModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-full font-bold transition-all shadow-lg hover:shadow-xl focus:outline-none focus:ring-4 focus:ring-blue-300">
                    Go to Next Situation ‚Üí
                </button>
            </div>
        </div>
    </div>


    <script>
        // --- JAVASCRIPT LOGIC ---
        // Training State
        let trainingState = {
            currentScenario: null,
            currentStep: 0,
            correctAnswers: 0,
            totalQuestions: 0,
            completedScenarios: [],
            achievements: []
        };

        // FULL SCENARIO DATABASE
        const scenarios = {
            'meeting-reminder': {
                title: 'Meeting Reminder',
                description: 'Send a professional meeting reminder to your team',
                icon: 'üìÖ',
                difficulty: 'Beginner',
                groupName: 'Marketing Team',
                groupInfo: '8 participants',
                avatar: 'üìä',
                steps: [
                    {
                        context: "You need to remind your team about tomorrow's important client presentation meeting at 10 AM.",
                        messages: [
                            { sender: 'system', text: 'You need to send a meeting reminder to your team', type: 'info' }
                        ],
                        prompt: "How would you remind your team about the meeting?",
                        options: [
                            {
                                text: "hey guys dont forget meeting tomorrow 10am",
                                feedback: "This is **too casual** and lacks essential information like the day, location, and purpose. Professional reminders must be clear and complete.",
                                correct: false
                            },
                            {
                                text: "Good morning team! Friendly reminder about our client presentation meeting tomorrow (Tuesday) at 10:00 AM in Conference Room B. Please bring your project updates. Thanks!",
                                feedback: "This response is **perfect**! It uses a professional tone, includes all necessary details (day, time, location, and pre-meeting action item), and uses polite language.",
                                correct: true
                            },
                            {
                                text: "MEETING TOMORROW 10AM DON'T BE LATE!!!",
                                feedback: "This is **too aggressive** and unprofessional. Avoid using all caps and threatening language in office communications; it creates a hostile environment.",
                                correct: false
                            }
                        ]
                    },
                    {
                        context: "A team member asks if they can join the meeting virtually due to illness.",
                        messages: [
                            { sender: 'Sarah', text: 'Hi, I\'m feeling unwell today. Can I join the meeting virtually tomorrow?', type: 'received' }
                        ],
                        prompt: "How would you respond to Sarah's request?",
                        options: [
                            {
                                text: "No, you need to be there in person",
                                feedback: "This is **too harsh and inflexible**. Good managers accommodate reasonable requests, especially related to health, and provide solutions.",
                                correct: false
                            },
                            {
                                text: "Of course, Sarah! Hope you feel better soon. I'll send you the meeting link. Take care! üôÇ",
                                feedback: "This is an **excellent** response. It shows empathy, immediately provides a solution (the link), and maintains a professional yet caring tone. This builds loyalty.",
                                correct: true
                            },
                            {
                                text: "ok",
                                feedback: "This is **too brief** and doesn't show care or provide the necessary information (the meeting link). Always be complete and courteous.",
                                correct: false
                            }
                        ]
                    }
                ]
            },
            'project-update': {
                title: 'Project Status Update',
                description: 'Share project progress with stakeholders professionally',
                icon: 'üìà',
                difficulty: 'Intermediate',
                groupName: 'Project Alpha Team',
                groupInfo: '12 participants',
                avatar: 'üéØ',
                steps: [
                    {
                        context: "Your project is running slightly behind schedule and you need to update the team.",
                        messages: [
                            { sender: 'system', text: 'You need to provide a project status update', type: 'info' }
                        ],
                        prompt: "How would you communicate the project delay?",
                        options: [
                            {
                                text: "we're behind schedule, not my fault though",
                                feedback: "This is **unprofessional and defensive**. Always maintain accountability and focus on solutions, not shifting blame, in public communications.",
                                correct: false
                            },
                            {
                                text: "Hi team, Quick update on Project Alpha: We're currently 2 days behind due to unexpected technical challenges. Working on solutions and will have revised timeline by Friday. Will keep you posted. Thanks for your patience!",
                                feedback: "This is **perfect**! It is transparent, specific (2 days behind), offers a reason (technical challenges), and clearly outlines the next steps (revised timeline by Friday).",
                                correct: true
                            },
                            {
                                text: "everything is fine, no problems here",
                                feedback: "This is **dishonest and unhelpful**. Transparency is a crucial part of project management. Hiding issues only makes them worse later.",
                                correct: false
                            }
                        ]
                    },
                    {
                        context: "A stakeholder asks for more details about the delay.",
                        messages: [
                            { sender: 'Manager', text: 'Can you provide more details about what technical challenges we\'re facing?', type: 'received' }
                        ],
                        prompt: "How would you provide more details?",
                        options: [
                            {
                                text: "it's complicated, you wouldn't understand",
                                feedback: "This is **condescending and unprofessional**. Always respect your colleagues' need for clear, factual explanations, even if simplifying technical details.",
                                correct: false
                            },
                            {
                                text: "Sure! The main issue is database integration taking longer than expected. Our dev team is working with IT to resolve compatibility issues. I can schedule a brief call if you'd like more technical details.",
                                feedback: "This is an **excellent** response. It gives a specific and helpful summary of the issue, names the teams working on it, and offers an additional channel (a call) for deeper discussion.",
                                correct: true
                            },
                            {
                                text: "just some tech stuff, will be fixed soon",
                                feedback: "This is **too vague and dismissive**. Stakeholders require specific information to understand the risk and make informed decisions.",
                                correct: false
                            }
                        ]
                    }
                ]
            },
            'urgent-request': {
                title: 'Handling Urgent Requests',
                description: 'Respond appropriately to urgent work requests',
                icon: 'üö®',
                difficulty: 'Advanced',
                groupName: 'Operations Team',
                groupInfo: '15 participants',
                avatar: '‚ö°',
                steps: [
                    {
                        context: "Your manager sends an urgent request for a report that's needed in 2 hours.",
                        messages: [
                            { sender: 'Manager', text: 'Hi, I need the Q3 sales report ASAP for the board meeting at 3 PM today. Can you help?', type: 'received' }
                        ],
                        prompt: "How would you respond to this urgent request?",
                        options: [
                            {
                                text: "impossible, I'm busy with other things",
                                feedback: "This is **too negative and unhelpful**. In professional settings, even if you can't fulfill a request, you should try to offer a solution, an alternative, or a partial solution.",
                                correct: false
                            },
                            {
                                text: "Hi! I understand the urgency. I can have the Q3 sales report ready by 2:30 PM. I'll prioritize this and send it directly to you. Is there a specific format you need?",
                                feedback: "This is **perfect**. It acknowledges the urgency, commits to a *realistic and specific* time, shows you are prioritizing it, and preemptively asks a clarifying question (format).",
                                correct: true
                            },
                            {
                                text: "why didn't you ask earlier?",
                                feedback: "This is **unprofessional and confrontational**. Focus on delivering what is needed, not blaming the requestor for poor planning.",
                                correct: false
                            }
                        ]
                    },
                    {
                        context: "While working on the urgent report, another colleague asks for help with their task.",
                        messages: [
                            { sender: 'John', text: 'Hey, can you help me with the client presentation? I\'m stuck on the financial projections.', type: 'received' }
                        ],
                        prompt: "How would you handle this conflicting priority?",
                        options: [
                            {
                                text: "can't help, too busy",
                                feedback: "This is **too abrupt**. You need to be brief, but still professional and helpful by offering an alternative solution.",
                                correct: false
                            },
                            {
                                text: "Hi John! I'm currently working on an urgent report for the board meeting, but I can help you right after (around 3 PM). Alternatively, Sarah from finance might be available now if it's urgent. Let me know!",
                                feedback: "This is an **excellent** response. It clearly explains the current priority, offers a specific alternative time, and suggests another available resource. This balances priorities while remaining helpful.",
                                correct: true
                            },
                            {
                                text: "ask someone else",
                                feedback: "This is **dismissive and unhelpful**. A better response would be to briefly explain your own situation and *then* suggest an alternative person.",
                                correct: false
                            }
                        ]
                    }
                ]
            },
            'feedback-delivery': {
                title: 'Giving Constructive Feedback',
                description: 'Provide feedback professionally and constructively',
                icon: 'üí¨',
                difficulty: 'Advanced',
                groupName: 'Design Team',
                groupInfo: '6 participants',
                avatar: 'üé®',
                steps: [
                    {
                        context: "A team member shared their work and you notice some issues that need addressing.",
                        messages: [
                            { sender: 'Alex', text: 'Hi everyone! Here\'s the new logo design for the Johnson project. What do you think?', type: 'received' },
                            { sender: 'system', text: 'Alex shared: logo_design_v1.png', type: 'file' }
                        ],
                        prompt: "The design has some issues. How would you provide feedback?",
                        options: [
                            {
                                text: "this looks terrible, start over",
                                feedback: "This is **too harsh and demotivating**. Feedback should always be delivered constructively, focusing on the work's objective shortcomings, not personal criticism.",
                                correct: false
                            },
                            {
                                text: "Great work on the concept, Alex! I like the color scheme. For the Johnson brand, we might want to consider making the font slightly bolder and adjusting the spacing. What do you think about trying those tweaks?",
                                feedback: "This is **perfect**. It starts with a positive comment, gives specific, actionable suggestions, and uses collaborative language ('we might want to consider', 'What do you think'). This is constructive feedback at its best.",
                                correct: true
                            },
                            {
                                text: "looks good to me",
                                feedback: "While positive, this is **unhelpful**. Good feedback is honest and helps the work improve. Being silent about issues is a disservice to the project and the team member.",
                                correct: false
                            }
                        ]
                    },
                    {
                        context: "Alex responds positively to your feedback and asks for more specific guidance.",
                        messages: [
                            { sender: 'Alex', text: 'Thanks for the feedback! Can you be more specific about the spacing? I want to get this right.', type: 'received' }
                        ],
                        prompt: "How would you provide more detailed guidance?",
                        options: [
                            {
                                text: "just make it look better",
                                feedback: "This is **too vague** and frustrating. When asked for specific guidance, you must provide clear, actionable, and measurable advice.",
                                correct: false
                            },
                            {
                                text: "Sure! Try increasing the space between the icon and text by about 20%, and reduce the letter spacing in the company name slightly. I can hop on a quick call if you'd like to go through it together!",
                                feedback: "This is **excellent**. It provides specific, measurable guidance (20% increase, reduce letter spacing) and offers further support (a call). This demonstrates effective mentorship.",
                                correct: true
                            },
                            {
                                text: "you should know how to do this",
                                feedback: "This is **condescending and unhelpful**. Good team leaders focus on helping colleagues grow, not on making them feel inadequate.",
                                correct: false
                            }
                        ]
                    }
                ]
            },
            'conflict-resolution': {
                title: 'Managing Group Conflicts',
                description: 'Handle disagreements professionally in group chats',
                icon: 'ü§ù',
                difficulty: 'Expert',
                groupName: 'Cross-functional Team',
                groupInfo: '10 participants',
                avatar: '‚öñÔ∏è',
                steps: [
                    {
                        context: "Two team members are having a disagreement in the group chat about project priorities.",
                        messages: [
                            { sender: 'Mike', text: 'I think we should focus on the mobile app first. It\'s more important for our users.', type: 'received' },
                            { sender: 'Lisa', text: 'That\'s wrong. The website redesign should be our priority. We\'re losing customers because of the poor UX.', type: 'received' },
                            { sender: 'Mike', text: 'You\'re not seeing the bigger picture here, Lisa.', type: 'received' }
                        ],
                        prompt: "How would you handle this escalating disagreement?",
                        options: [
                            {
                                text: "guys, stop fighting",
                                feedback: "This is **too casual** and minimizes the issue. Professional conflict resolution requires thoughtful intervention and a process for resolution.",
                                correct: false
                            },
                            {
                                text: "Hi team, I can see we have different perspectives on priorities, which is valuable! Both mobile and web are important. Let's schedule a brief meeting to discuss this properly and align on our roadmap. Mike and Lisa, can you both prepare your key points?",
                                feedback: "This is **perfect**. It acknowledges both viewpoints (reframing the conflict as valuable input), suggests moving the debate to a proper forum (a meeting), and sets clear expectations for the next step. This maintains professionalism and group harmony.",
                                correct: true
                            },
                            {
                                text: "Lisa is right, Mike you're wrong",
                                feedback: "This **takes sides** and will escalate the conflict while damaging team dynamics. A good leader facilitates discussion, they do not pick a winner in a public chat.",
                                correct: false
                            }
                        ]
                    },
                    {
                        context: "After your intervention, one team member continues to be confrontational.",
                        messages: [
                            { sender: 'Mike', text: 'I don\'t need a meeting. My point is clear and I\'m not changing my mind.', type: 'received' }
                        ],
                        prompt: "How would you handle this continued resistance?",
                        options: [
                            {
                                text: "Mike, you're being difficult",
                                feedback: "This is a **personal attack** and will immediately worsen the situation. Always stay professional and focus on process, not personality.",
                                correct: false
                            },
                            {
                                text: "I understand you feel strongly about this, Mike. Let's take this conversation offline to discuss your concerns properly. I'll send you a calendar invite. Thanks everyone for your input!",
                                feedback: "This is **excellent**. It acknowledges his feelings, professionally extracts the conflict from the group chat (taking it offline), and allows the rest of the team to return to work. This protects group morale.",
                                correct: true
                            },
                            {
                                text: "fine, do whatever you want",
                                feedback: "This is **passive-aggressive and unprofessional**. Leaders must address conflicts constructively, not give up or act annoyed.",
                                correct: false
                            }
                        ]
                    }
                ]
            }
        };

        // --- UX / UTILITY FUNCTIONS ---
        
        function scrollToBottom() {
            const chatMessages = document.getElementById('chatMessages');
            if (chatMessages) {
                chatMessages.scrollTo({ top: chatMessages.scrollHeight, behavior: 'smooth' });
            }
        }
        
        function updateGuide(message) {
            document.getElementById('guideMessage').textContent = message;
        }

        // --- CORE APPLICATION LOGIC ---

        function startTraining() {
            document.getElementById('welcomeScreen').classList.add('hidden');
            document.getElementById('scenarioSelection').classList.remove('hidden');
            loadScenarios();
            updateGuide("Great! Now, **click on any scenario card** (e.g., 'Meeting Reminder') to start the role-play.");
        }

        function loadScenarios() {
            const grid = document.getElementById('scenarioGrid');
            grid.innerHTML = '';

            Object.keys(scenarios).forEach(scenarioId => {
                const scenario = scenarios[scenarioId];
                const isCompleted = trainingState.completedScenarios.includes(scenarioId);
                
                const card = document.createElement('div');
                card.className = `scenario-card bg-white p-6 rounded-2xl shadow-xl cursor-pointer ${isCompleted ? 'border-l-4 border-green-500' : 'border-l-4 border-gray-200'}`;
                card.onclick = () => startScenario(scenarioId);
                
                card.innerHTML = `
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-5xl">${scenario.icon}</div>
                        ${isCompleted ? '<div class="badge text-green-600 text-3xl">‚úÖ</div>' : ''}
                    </div>
                    <h3 class="text-xl font-extrabold text-gray-900 mb-2">${scenario.title}</h3>
                    <p class="text-gray-500 mb-4">${scenario.description}</p>
                    <div class="flex items-center justify-between pt-2 border-t border-gray-100">
                        <span class="px-3 py-1 bg-indigo-100 text-indigo-800 rounded-full text-sm font-medium">${scenario.difficulty}</span>
                        <span class="text-sm text-gray-500">${scenario.steps.length} situations</span>
                    </div>
                `;
                
                grid.appendChild(card);
            });
            updateGuide("Choose a scenario above. Completed scenarios are marked with a green check (‚úÖ).");
        }

        function startScenario(scenarioId) {
            trainingState.currentScenario = scenarioId;
            trainingState.currentStep = 0;
            trainingState.correctAnswers = 0;
            trainingState.totalQuestions = 0;

            const scenario = scenarios[scenarioId];
            
            // IMMEDIATE CLEARING FIX: Clear UI elements before showing the chat interface
            document.getElementById('chatMessages').innerHTML = ''; // Clear chat history immediately
            document.getElementById('optionButtons').innerHTML = ''; // Clear options immediately
            document.getElementById('feedbackModal').classList.add('hidden'); // Ensure modal is closed
            
            // Update chat header
            document.getElementById('groupName').textContent = scenario.groupName;
            document.getElementById('groupInfo').textContent = scenario.groupInfo;
            document.getElementById('groupAvatar').textContent = scenario.avatar;

            // Show chat interface
            document.getElementById('scenarioSelection').classList.add('hidden');
            document.getElementById('chatInterface').classList.remove('hidden');

            // Start first step
            loadStep();
        }

        function loadStep() {
            const scenario = scenarios[trainingState.currentScenario];
            const step = scenario.steps[trainingState.currentStep];
            
            // Clear previous messages (important for step-to-step transitions)
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = '';
            
            // Ensure modal is closed before new messages arrive
            document.getElementById('feedbackModal').classList.add('hidden');
            
            // Drastically reduced delays for quicker loading
            const staggerDelay = 200; 
            let totalDelay = 0;
            
            // Add context message instantly
            if (step.context) {
                addMessage('system', step.context, 'info'); 
            }
            
            // Add step messages with a much faster stagger
            step.messages.forEach((message, index) => {
                totalDelay += staggerDelay;
                setTimeout(() => {
                    addMessage(message.sender, message.text, message.type);
                }, totalDelay);
            });
            
            // Show response options 300ms after the last message has been scheduled
            const delayBeforeOptions = totalDelay + 300;
            
            setTimeout(() => {
                showResponseOptions(step);
            }, delayBeforeOptions);
        }

        function addMessage(sender, text, type = 'received') {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            
            if (type === 'info') {
                messageDiv.className = 'text-center mb-6 message-bubble';
                messageDiv.innerHTML = `
                    <div class="bg-indigo-100 text-indigo-800 px-5 py-3 rounded-xl inline-block text-sm font-medium shadow-md">
                        ‚ÑπÔ∏è ${text}
                    </div>
                `;
            } else if (type === 'file') {
                messageDiv.className = 'flex justify-start mb-4 message-bubble';
                messageDiv.innerHTML = `
                    <div class="received-message p-3 max-w-xs shadow-lg">
                        <div class="flex items-center space-x-2">
                            <div class="text-3xl">üìé</div>
                            <div>
                                <div class="font-medium text-sm">${text}</div>
                                <div class="text-xs text-gray-500">File attachment</div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (type === 'sent') {
                messageDiv.className = 'flex justify-end mb-4 message-bubble';
                messageDiv.innerHTML = `
                    <div class="sent-message p-3 shadow-lg">
                        <div class="text-sm">${text}</div>
                        <div class="text-xs text-blue-800 mt-1 text-right font-semibold">‚úì‚úì</div>
                    </div>
                `;
            } else {
                messageDiv.className = 'flex justify-start mb-4 message-bubble';
                messageDiv.innerHTML = `
                    <div class="received-message p-3 shadow-lg">
                        <div class="font-bold text-xs text-emerald-600 mb-1">${sender}</div>
                        <div class="text-sm">${text}</div>
                    </div>
                `;
            }
            
            chatMessages.appendChild(messageDiv);
            scrollToBottom(); 
        }

        function showResponseOptions(step) {
            document.getElementById('situationPrompt').textContent = step.prompt;
            const optionButtons = document.getElementById('optionButtons');
            optionButtons.innerHTML = '';
            
            step.options.forEach((option) => {
                const button = document.createElement('button');
                button.className = 'option-button w-full text-left p-4 bg-white hover:bg-gray-50 rounded-xl border border-gray-200 transition-all';
                button.textContent = option.text;
                // Pass all options to the handler
                button.onclick = () => selectOption(option, button, step.options); 
                optionButtons.appendChild(button);
            });
            updateGuide("Read the prompt above and **click the response** that you think is most professional.");
        }

        function showFeedbackModal(selectedOption, allOptions) {
            const modal = document.getElementById('feedbackModal');
            const correctDisplay = document.getElementById('correctResponseDisplay');
            const isCorrect = selectedOption.correct;
            const correctOption = allOptions.find(opt => opt.correct);
            
            // --- NEW LOGIC: Hide 'The Best Approach' if the user chose correctly ---
            if (isCorrect) {
                correctDisplay.classList.add('hidden-when-correct');
                document.getElementById('modalIcon').textContent = '‚úÖ';
                document.getElementById('modalTitle').textContent = 'Excellent Choice!';
            } else {
                correctDisplay.classList.remove('hidden-when-correct');
                document.getElementById('modalIcon').textContent = '‚ùå';
                document.getElementById('modalTitle').textContent = 'Needs Refinement.';
            }
            
            // Set User Response Display
            document.getElementById('userResponseText').textContent = selectedOption.text;
            document.getElementById('selectedOptionDisplay').className = `p-3 border-l-4 rounded-md shadow-inner ${isCorrect ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50'}`;
            
            // Set Correct Response Display (Always set it, but it may be hidden by the class above)
            document.getElementById('correctResponseText').textContent = correctOption.text;
            
            // Set Detailed Reason
            document.getElementById('reasonText').innerHTML = selectedOption.feedback;

            // Show modal
            modal.classList.remove('hidden');
            
            // Update guide to prompt next action
            updateGuide("Review the detailed feedback in the pop-up, then click **'Go to Next Situation'**.");
        }

        function selectOption(selectedOption, buttonElement, allOptions) {
            // Only allow one click per step
            if (buttonElement.disabled) return; 
            
            trainingState.totalQuestions++;
            if (selectedOption.correct) {
                trainingState.correctAnswers++;
            }
            
            // Visually mark the selected button and disable all
            const allButtons = document.querySelectorAll('.option-button');
            allButtons.forEach(btn => {
                btn.disabled = true;
                btn.classList.remove('hover:bg-gray-50'); // Remove hover effect
                btn.classList.add('cursor-not-allowed'); // Indicate disabled state
            });

            // Highlight the selected option (Correct/Incorrect)
            if (selectedOption.correct) {
                buttonElement.classList.add('option-correct');
                buttonElement.classList.remove('bg-white');
            } else {
                buttonElement.classList.add('option-incorrect');
                buttonElement.classList.remove('bg-white');
            }
            
            // Scroll to bottom immediately (to see the sent message)
            scrollToBottom(); 

            // Add user's selected message to chat (fast)
            setTimeout(() => {
                addMessage('You', selectedOption.text, 'sent');
                
                // Show the new feedback modal after user message is sent
                setTimeout(() => {
                    showFeedbackModal(selectedOption, allOptions);
                }, 500); // Slight delay for the chat to settle
            }, 200);
        }
        
        // New function to handle closing the modal and advancing the scenario
        function nextStepFromModal() {
            document.getElementById('feedbackModal').classList.add('hidden');
            
            // Clear options buttons to prepare for the next step
            document.getElementById('optionButtons').innerHTML = ''; 
            
            if (trainingState.currentStep < scenarios[trainingState.currentScenario].steps.length - 1) {
                nextStep(); // Existing function to increment step and call loadStep()
            } else {
                completeScenario();
            }
        }

        function nextStep() {
            trainingState.currentStep++;
            loadStep();
        }

        function completeScenario() {
            const scenarioId = trainingState.currentScenario;
            
            if (!trainingState.completedScenarios.includes(scenarioId)) {
                trainingState.completedScenarios.push(scenarioId);
            }
            
            updateProgress();
            showResults();
            checkAchievements();
            updateGuide("Scenario Complete! Review your performance metrics and choose your next action.");
        }

        function showResults() {
            document.getElementById('chatInterface').classList.add('hidden');
            document.getElementById('resultsScreen').classList.remove('hidden');
            
            const percentage = Math.round((trainingState.correctAnswers / trainingState.totalQuestions) * 100);
            
            document.getElementById('correctAnswers').textContent = trainingState.correctAnswers;
            document.getElementById('totalQuestions').textContent = trainingState.totalQuestions;
            document.getElementById('scorePercentage').textContent = percentage + '%';
            
            let emoji, title, message;
            if (percentage >= 90) {
                emoji = 'üèÜ'; title = 'Outstanding! Master Communicator!'; message = 'You have flawless professional communication skills. Excellent work!';
            } else if (percentage >= 70) {
                emoji = 'üéâ'; title = 'Great Job!'; message = 'You\'re developing strong communication skills. Review the feedback and keep practicing!';
            } else if (percentage >= 50) {
                emoji = 'üëç'; title = 'Good Effort!'; message = 'You\'re on the right track. Focus on the core principles and try again!';
            } else {
                emoji = 'üìö'; title = 'Keep Learning!'; message = 'Communication skills take practice. Review the tips and try again to master these scenarios!';
            }
            
            document.getElementById('resultEmoji').textContent = emoji;
            document.getElementById('resultTitle').textContent = title;
            document.getElementById('resultMessage').textContent = message;
        }

        function updateProgress() {
            const totalScenarios = Object.keys(scenarios).length;
            const completedCount = trainingState.completedScenarios.length;
            const percentage = (completedCount / totalScenarios) * 100;
            
            document.getElementById('progressBar').style.width = percentage + '%';
            document.getElementById('progressText').textContent = `${completedCount}/${totalScenarios} Scenarios`;
        }

        function checkAchievements() {
            const completedCount = trainingState.completedScenarios.length;
            const percentage = Math.round((trainingState.correctAnswers / trainingState.totalQuestions) * 100);
            
            if (completedCount === 1 && !trainingState.achievements.includes('first-scenario')) {
                showAchievement('üéØ', 'First Steps Achieved', 'Completed your first communication scenario!');
                trainingState.achievements.push('first-scenario');
            }
            
            if (percentage === 100 && !trainingState.achievements.includes('perfect-score') && trainingState.totalQuestions > 0) {
                showAchievement('üíØ', 'Perfect Score!', 'A flawless performance in this scenario!');
                trainingState.achievements.push('perfect-score');
            }
            
            if (completedCount === Object.keys(scenarios).length && !trainingState.achievements.includes('master-communicator')) {
                showAchievement('üèÜ', 'Master Communicator', 'You have completed all scenarios! Well done!');
                trainingState.achievements.push('master-communicator');
            }
        }

        function showAchievement(icon, title, description) {
            const notification = document.getElementById('achievementNotification');
            document.getElementById('achievementIcon').textContent = icon;
            document.getElementById('achievementTitle').textContent = title;
            document.getElementById('achievementDesc').textContent = description;
            
            notification.classList.remove('translate-x-full');
            
            setTimeout(() => {
                notification.classList.add('translate-x-full');
            }, 4000);
        }

        function backToScenarios() {
            document.getElementById('chatInterface').classList.add('hidden');
            document.getElementById('resultsScreen').classList.add('hidden');
            document.getElementById('scenarioSelection').classList.remove('hidden');
            document.getElementById('feedbackModal').classList.add('hidden'); // Close modal
            loadScenarios();
        }

        function restartScenario() {
            document.getElementById('resultsScreen').classList.add('hidden');
            document.getElementById('feedbackModal').classList.add('hidden'); // Close modal
            if (trainingState.currentScenario) {
                startScenario(trainingState.currentScenario);
            }
        }

        // Initialize progress and guide on page load
        window.addEventListener('load', () => {
            updateProgress();
            updateGuide("Welcome! Click the **'üöÄ Start Your Training Journey'** button above to begin!");
        });
    </script>
</body>
</html>
